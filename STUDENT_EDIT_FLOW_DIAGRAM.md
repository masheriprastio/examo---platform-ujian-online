# ğŸ“Š Visual Flow: Student Edit Data Update

## Before Fix âŒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Guru: Edit Email "adates@gmail.com" â†’ "ada_baru@..."  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ StudentManager                 â”‚
        â”‚ - Collect form data            â”‚
        â”‚ - Call onUpdate(updatedList)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ App.tsx: handleStudentUpdate()â”‚
         â”‚ (Untuk BULK import)          â”‚
         â”‚                              â”‚
         â”‚ - Deteksi new students       â”‚
         â”‚ - Insert ke DB (add only)    â”‚
         â”‚ - TIDAK update existing!     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ UI State Updated â”‚        â”‚ DB Not Sync  â”‚
    â”‚ Email: ada_... âœ“ â”‚        â”‚ Email: âŒ    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Refresh Browser          â”‚
    â”‚ Data lost! (tidak persist)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Login dengan email baru      â”‚
â”‚ Query DB â†’ Email lama!!!     â”‚
â”‚ âŒ Login GAGAL              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## After Fix âœ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Guru: Edit Email "adates@gmail.com" â†’ "ada_baru@..."  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ StudentManager                 â”‚
        â”‚ - Collect form data            â”‚
        â”‚ - Call onEditStudent() â† NEW! â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ App.tsx: handleEditStudent() â”‚ â† NEW HANDLER
         â”‚ (Khusus untuk EDIT)          â”‚
         â”‚                              â”‚
         â”‚ Step 1:                      â”‚
         â”‚ â”œâ”€ Optimistic UI update      â”‚
         â”‚ â”‚  setStudents([...])   â”€â”€â”€â”€â”€â”¼â”€â”€â†’ Email berubah instant
         â”‚ â”‚                       â”‚    â”‚
         â”‚ Step 2:                 â”‚    â”‚
         â”‚ â”œâ”€ Sync ke Database     â”‚    â”‚
         â”‚ â”‚  supabase.users       â”‚    â”‚
         â”‚ â”‚  .update({...})       â”‚    â”‚
         â”‚ â”‚  .eq('id', id)    â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â†’ DB updated
         â”‚ â”‚                   â”‚    â”‚
         â”‚ Step 3:            â”‚    â”‚
         â”‚ â”œâ”€ Handle response  â”‚    â”‚
         â”‚ â”‚  âœ… Success alert  â”‚    â”‚
         â”‚ â”‚  âŒ Error â†’ Rollback
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼             â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ UI Updated âœ“     â”‚ â”‚ DB Sync âœ“    â”‚ â”‚ Alert Show  â”‚
    â”‚ Email: ada_...   â”‚ â”‚ Email: ada_..â”‚ â”‚ "Success!"  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                 â”‚
              â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Refresh Browser              â”‚
    â”‚ Data Tetap (dari DB) âœ“       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Login dengan email baru      â”‚
    â”‚ Query DB â†’ Email baru! âœ“     â”‚
    â”‚ âœ… Login BERHASIL           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram

### Update Flow

```
USER (Guru)
    â”‚
    â”œâ”€ Edit Form
    â”‚  â”œâ”€ Name: "Budi Santoso New"
    â”‚  â”œâ”€ Email: "budi_new@sekolah.id"
    â”‚  â”œâ”€ Password: "budipass123"
    â”‚  â””â”€ Click "Update Siswa"
    â”‚
    â–¼
REACT COMPONENT (StudentManager)
    â”‚
    â”œâ”€ Validate form
    â”œâ”€ Create updatedStudent object
    â”‚  {
    â”‚    id: "siswa-123",
    â”‚    name: "Budi Santoso New",
    â”‚    email: "budi_new@sekolah.id",
    â”‚    password: "budipass123",
    â”‚    ...
    â”‚  }
    â””â”€ Call onEditStudent(updatedStudent)
    â”‚
    â–¼
STATE HANDLER (App.tsx handleEditStudent)
    â”‚
    â”œâ”€ ğŸŸ¢ STEP 1: OPTIMISTIC UPDATE
    â”‚  â””â”€ setStudents(prev => 
    â”‚       prev.map(s => 
    â”‚         s.id === studentId ? updatedStudent : s
    â”‚       )
    â”‚     )
    â”‚     [Result: UI renders immediately with new data]
    â”‚
    â”œâ”€ ğŸ”µ STEP 2: DATABASE SYNC
    â”‚  â””â”€ supabase.from('users')
    â”‚       .update({ name, email, password, ... })
    â”‚       .eq('id', studentId)
    â”‚
    â””â”€ ğŸŸ¡ STEP 3: HANDLE RESPONSE
       â”œâ”€ âœ… Success:
       â”‚  â””â”€ addAlert('Data siswa berhasil diperbarui!', 'success')
       â”‚
       â””â”€ âŒ Error:
          â”œâ”€ Log error to console
          â”œâ”€ Revert optimistic update (rollback)
          â””â”€ addAlert('Gagal update...', 'error')
    â”‚
    â–¼
DATABASE (Supabase)
    â”‚
    â”œâ”€ Table: users
    â”‚  Row ID: siswa-123
    â”‚  {
    â”‚    id: "siswa-123",
    â”‚    name: "Budi Santoso New",        â† UPDATED
    â”‚    email: "budi_new@sekolah.id",    â† UPDATED
    â”‚    password: "budipass123",         â† UPDATED
    â”‚    grade: "XII-IPA-2",
    â”‚    nis: "999",
    â”‚    ...
    â”‚  }
    â”‚
    â””â”€ âœ… DATA PERSISTED
    â”‚
    â–¼
NEXT LOGIN (Siswa)
    â”‚
    â”œâ”€ Login Form
    â”‚  â”œâ”€ Email: "budi_new@sekolah.id"
    â”‚  â””â”€ Password: "budipass123"
    â”‚
    â–¼
AUTH HANDLER (App.tsx handleLogin)
    â”‚
    â””â”€ Query DB: 
       SELECT * FROM users 
       WHERE email = "budi_new@sekolah.id"
    â”‚
    â–¼
DATABASE QUERY
    â”‚
    â””â”€ Found: User with matching email & password
    â”‚
    â–¼
âœ… LOGIN SUCCESS
    â”‚
    â””â”€ User redirected to STUDENT_DASHBOARD
```

---

## State Management Timeline

```
TIME  UI STATE              DB STATE             USER SEES
â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T0    Ada Tes               Ada Tes              Dialog open
      adates@gmail.com      adates@gmail.com     Form showing current
      
T1    [Click Edit]          Ada Tes              Dialog updated
      Edit dialog open      adates@gmail.com     Fields filled
      
T2    [Change email]        Ada Tes              Input shows
      Form data:            adates@gmail.com     new email
      ada_baru@...
      
T3    [Click Update]        Ada Tes              Dialog shows
      Submitting...         adates@gmail.com     loading state
      
T4    âœ“ OPTIMISTIC UPDATE   Ada Tes (syncing)    Table updates!
      Ada Tes               adates@gmail.com     New email appears
      ada_baru@...                               Dialog closed
      
T5    âœ“ DB SYNC DONE        Ada Tes              Alert appears
      Ada Tes               ada_baru@...         "Success!"
      ada_baru@...
      
T6    [User refreshes]      Ada Tes              Data persists!
      Ada Tes               ada_baru@...         New email still there
      ada_baru@...
      
T7    [User logout]         Ada Tes              ---
      ---                   ada_baru@...
      
T8    [User login with       Ada Tes              âœ… LOGIN OK!
      new email]            ada_baru@...         Redirect to
                                                  dashboard
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleEditStudent(updatedStudent)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Optimistic Update      â”‚
         â”‚ setStudents(updated)   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Try Supabase Update        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
              â”‚             â”‚
         âœ… SUCCESS      âŒ ERROR
              â”‚             â”‚
              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚         â”‚ Rollback UI â”‚
              â”‚         â”‚ Revert data â”‚
              â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚                â”‚
              â”‚         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚         â”‚ Show Error Alertâ”‚
              â”‚         â”‚ "Gagal update..."
              â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Show Success Alertâ”‚
         â”‚ "Berhasil..."     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Communication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ StudentManager.tsx                                      â”‚
â”‚                                                         â”‚
â”‚  handleSubmitManual()                                   â”‚
â”‚  â”œâ”€ if (modalMode === 'add')                            â”‚
â”‚  â”‚  â””â”€ onAddStudent(newStudent)                         â”‚
â”‚  â”‚                                                      â”‚
â”‚  â””â”€ else if (modalMode === 'edit')                      â”‚
â”‚     â””â”€ onEditStudent(editedStudent) â† NEW PATH          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ async callback
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App.tsx                                                 â”‚
â”‚                                                         â”‚
â”‚  handleEditStudent(editedStudent)                       â”‚
â”‚  â”œâ”€ Step 1: Optimistic update                           â”‚
â”‚  â”‚  â””â”€ setStudents([...])                               â”‚
â”‚  â”‚                                                      â”‚
â”‚  â”œâ”€ Step 2: DB sync                                     â”‚
â”‚  â”‚  â””â”€ supabase.users.update(...).eq('id', id)         â”‚
â”‚  â”‚                                                      â”‚
â”‚  â””â”€ Step 3: Handle response                             â”‚
â”‚     â”œâ”€ âœ… addAlert('success')                            â”‚
â”‚     â””â”€ âŒ addAlert('error') + rollback                   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ supabase query
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase (PostgreSQL)                                   â”‚
â”‚                                                         â”‚
â”‚  UPDATE users SET                                       â”‚
â”‚    name = 'new name',                                   â”‚
â”‚    email = 'new email',                                 â”‚
â”‚    password = 'new password',                           â”‚
â”‚    ...                                                  â”‚
â”‚  WHERE id = 'siswa-123'                                 â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Diagram Version**: 2025-02-24 âœ“
